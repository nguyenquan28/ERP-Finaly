
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-title" content="CodePen">
    <title>Medusa Shop</title>
    <link th:href="@{/resources/bootstrap/css/bootstrap.min.css}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="admin.css">
</head>

<body translate="no">
    <div class="container-fluid p-0">

        <div th:insert="fragments/header :: header"></div>

        <!-- container -->
        <div class="row mt-5 pt-1" id="body-row">

           <div th:insert="fragments/sidebar :: sidebar"></div>
            <!-- Sales body -->
            <div class="col body-sales">

                <!-- Sales Infomation -->
                <h2 class="mt-3">Bán hàng</h2>
                <hr>
                <div class="sales">
                    <!-- Header -->
                    <form class="form-group d-flex flex-row col-6 mt-2">
                        <div class="d-flex flex-row mr-5">
                            <label class="col-form-label pd-0">Chứng từ: </label>
                            <div class="col-3">
                                <input type="text" class="form-control-sm" placeholder="/BH" id="license">
                            </div>
                        </div>

                        <div class="d-flex flex-row">
                            <label class="col-form-label pd-0">Ngày bán: </label>
                            <div class="col-3">
                                <input type="text" class="form-control-sm" placeholder="dd/MM/yyyy">
                            </div>
                        </div>

                    </form>

                    <!-- Infomation -->
                    <div class="infomation d-flex flex-row">
                        <div class="sales-customer col-6">

                            <!-- Insert Customer Information -->
                            <h6>Thông tin khách hàng</h6>
                            <form>
                                <div class="form-group">
                                    <div class="">
                                        <div class="d-flex flex-row">
                                            <input type="text" class="form-control" 
                                                placeholder="Khách hàng" id="tenCT">
                                           
                                        </div>
                                        <div class="d-flex flex-row">
                                            <input type="text" class="form-control" placeholder="Email" id="email" >
                                            
                                        </div>
                                        <div class="d-flex flex-row">
                                            <input type="text" class="form-control"  placeholder="Điện thoại" id="phone" >
                                            <input type="text" class="form-control" placeholder="Địa chỉ" id="diaChi" >
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="sales-employees col-6">

                            <!-- Insert Employees Infomation -->
                            <h6>Thông tin nhân viên</h6>
                            <form>
                                <div class="form-group row">

                                    <label class="col-sm-3 col-form-label ml-4">Nhân viên bán: </label>
                                    <div class="col-8">
                                        <select class="form-control" id="employees">
                                           <!-- <option value="A">A</option>
                                           <option value="B">B</option> -->
                                        </select>
                                    </div>

                                    <label class="col-sm-3 col-form-label ml-4">Tên cửa hàng: </label>
                                    <div class="col-8">
                                        <select class="form-control" id="stores">
                                           	<!-- <option value="Cửa hàng A">Cửa hàng A</option>
                                           	<option value="Cửa hàng B">Cửa hàng B</option> -->
                                        </select>
                                    </div>

                                    <!-- <label class="col-sm-3 col-form-label ml-4">Mã ca bán hàng: </label>
                                    <div class="col-8">
                                        <select class="form-control" id="salecodes">
                                            
                                        </select>
                                    </div> -->
                                </div>
                            </form>
                        </div>
                    </div>
                    <hr>

                    <!-- Show product -->
                    <div class="Choose-product d-flex flex-row">
                        <form class="form-group d-flex flex-row">
                            <div class="d-flex flex-row mr-5">
                                <label class="col-form-label pd-0">Mã Sản Phẩm: </label>
                                <div class="col-3">
                                    <input type="text" class="form-control-sm" placeholder="***********" id="inputID">
                                </div>
                            </div>

                            <div class="d-flex flex-row">
                                <label class="col-form-label pd-0 ml-5">Số lượng: </label>
                                <div class="col-3">
                                    <input type="text" class="form-control-sm" placeholder="***" id="amounts">
                                </div>
                            </div>
                        </form>
                        <button type="button" class="btn-sm btn btn-dark ml-5" id="create">Xác nhận</button>
                    </div>

                    <table class="table">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Mã SP</th>
                                <th scope="col">Tên SP</th>
                                <th scope="col">Đơn vị</th>
                                <th scope="col">Đơn giá</th>
                                <th scope="col">Số lượng</th>
                                <th scope="col">Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody id="table">
                            
                        </tbody>
                    </table>
                    <hr>
                    <!-- Total -->
                    <div class="total d-flex flex-row">
                        <form class="col-5">
                            <div class="form-group d-flex flex-row">
                                <label class="col-form-label pd-0">Hình thức thanh toán:</label>
                                <div class="col-7">
                                    <select class="form-control-sm col-10" id="payments">
                                        <!-- <option value="1">Hình thước thanh toán 1</option>
                                        <option value="2">Hình thước thanh toán 2</option>
                                        <option value="3">Thanh Toán khi nhận hàng</option> -->
                                    </select>
                                </div>
                            </div>

                            <div class="form-group d-flex flex-row">
                                <label class="col-form-label pd-0 mr-5">Khuyến mãi:</label>
                                <div class="col-7 ml-4">
                                    <select class="form-control-sm col-10" id="discounts">
                                        <!-- <option value="10">10%</option>
                                        <option value="20">20%</option>
                                        <option value="50">50%</option> -->
                                    </select>
                                </div>
                            </div>
                            

                        </form>
                        <button type="button" class="btn-sm btn btn-dark mr-3" id="submit">Xác nhận</button>

                        <div class="total ml-5 col-3">
                            <div class="Sum d-flex flex-row">
                                <h6>Thành tiền: </h6>
                                <p id="sum" class="ml-4"></p>
                            </div>
                            <div class="Sum d-flex flex-row">
                                <h6>Khuyến mãi: </h6>
                                <p id="s" class="ml-2">000</p>
                            </div>
                            <div class="Sum d-flex flex-row">
                                <h6>Tổng tiền: </h6>
                                <p id="total" class="ml-4">000</p>
                            </div>
                        </div>

                            <button type="button" class="btn-sm btn btn-dark mr-5 mb-3" id="pay">Thanh toán</button>
                            <button type="button" class="btn-sm btn btn-dark mr-5">In hóa đơn</button>
                    </div>



                </div>
            </div>
        </div>
    </div>
	
	<!-- ------------------Script-------------------- -->
   <script th:src="@{/resources/jquery/jquery.min.js}"></script>
	<script th:src="@{/resources/bootstrap/js/bootstrap.js}"></script>
    <script src="main.js"></script>
    <script>
	
		/* Function show data */
		$(document).ready(function () {
				
		 		$.ajax({ url: "http://localhost:8080/showEmployees" })
		 			.then( function (data) {
		 						document.getElementById("table").innerHTML = "";
		 						/* console.log(data); */
		 						for (let i = 0; i < data.length; i++) {
		 							var rows = "";
		 							rows += "<option>" + data[i].tenNhanVien + "</option>";
		 							$(rows).appendTo("#employees");
		 						}
		 			})
					
				$.ajax({ url: "http://localhost:8080/showSalecodes" })
		 			.then( function (data) {
		 						document.getElementById("table").innerHTML = "";
		 						/* console.log(data); */
								for (let i = 0; i < data.length; i++) {
									var rows = "";
		 							rows += "<option>" + data[i].tenMaCa + "</option>";
									$(rows).appendTo("#salecodes");
		 						}
		 			})
					
		 		$.ajax({ url: "http://localhost:8080/showStores" })
		 			.then( function (data) {
		 						document.getElementById("table").innerHTML = "";
		 						/* console.log(data); */
								for (let i = 0; i < data.length; i++) {
									var rows = "";
		 							rows += "<option>" + data[i].tenCuaHang + "</option>";
		 							$(rows).appendTo("#stores");
		 						}
		 			})
					
		 		$.ajax({ url: "http://localhost:8080/showPayments" })
		 			.then( function (data) {
		 						document.getElementById("table").innerHTML = "";
								/* console.log(data); */
		 						for (let i = 0; i < data.length; i++) {
		 							var rows = "";
		 							rows += "<option>" + data[i].tenHTTT + "</option>";
		 							$(rows).appendTo("#payments");
		 						}
		 			})
					
		 		$.ajax({ url: "http://localhost:8080/showDiscounts" })
		 			.then( function (data) {
		 						document.getElementById("table").innerHTML = "";
		 						/* console.log(data); */
		 						for (let i = 0; i < data.length; i++) {
		 							var rows = "";
		 							rows += "<option value=" +data[i].phanTramKM+ ">" + data[i].tenKM + "</option>";
		 							$(rows).appendTo("#discounts");
		 						}
		 			})
			
		} );
		
		
		
		
		
		/* Function Add to  */
		
		/* Function save Product to Cart */
		 $(document).ready(function () {
		 	$("#create").click(function () {
		 		input=document.getElementById('inputID')
			 	amount=	 document.getElementById('amounts')
		 		$.ajax({ url: "http://localhost:8080/sales/addToCart?maSP=" + input.value })
		 			.then(function (product) {
                        
		 				var rows = "";
		 				rows += "<tr><td>" + product.maSP
		 					+ "</td><td>" + product.tenSP
							+ "</td><td>" + product.donVi
							+ "</td><td>" + product.donGia
		 					+ "</td><td>" + amount.value
							+ "</td><td>" + product.donGia*amount.value
		 					+ "</td></tr>";
		 				$(rows).appendTo("#table");
		 				$("#amounts").html()
		 				$("#inputID").html()
		 				/* Save carts */
		 				let cart = {
		 					"license" : $("#license").val(),
		 					"maSP" : product.maSP,
		 					"soLuong" : $("#amounts").val(),
		 					"donGia" : $("#amounts").val(),
		 					"phanLoai" : product.phanLoai,
		 					"donVi" : product.donVi,
		 					"ngaySanXuat" : product.ngaySanXuat,
		 					"hanSuDung" : product.hanSuDung,
		 					"tenSP" : product.tenSP,	
		 					
		 					"tongTien" : product.donGia*$("#amounts").val()
		 				}
						
		 				
		 				input.value=""
		 			 	amount.value=""
						
		 		})
		 		 
		 		
		 			
		 	});
		 	
		 	
		 	
		 });
		
		/* Function save Company partner */
		$(document).ready(function () {

			let thanhTien=0;
            let orderItems = []
                
			$("#submit").click(function () {								
					orderItems = []
	                let tb = document.getElementById("table")
	                let  rowSize = tb.rows.length
	                for(let i = 0 ; i < rowSize ; i++){
	                    let cell = tb.rows.item(i).cells;

	                    
	                        let orderItem = {}
	                        let product = {}
	                        product.maSP = cell.item(0).innerHTML
	                        product.tenSP = cell.item(1).innerHTML
	                        product.donVi = cell.item(2).innerHTML
	                        product.donGia = cell.item(3).innerHTML
	                        orderItem.product=product;
	                        orderItem.soLuong = cell.item(4).innerHTML
	                        orderItem.thanhtien = cell.item(5).innerHTML
	                        thanhTien += (parseInt(orderItem.thanhtien))
	                        orderItems.push(orderItem)
	                   
	                }
				
					let khuyenMai = $("#discounts").children("option:selected").val()
					
		            let tongTien = thanhTien - (thanhTien/100*khuyenMai)
	                document.getElementById("sum").innerText=thanhTien
	                document.getElementById("s").innerText=khuyenMai+"%"
	                
	                document.getElementById("total").innerText=tongTien               
					/* $.ajax({
						url: "http://localhost:8080/company",
					 	method: 'post', 
					 	dataType: 'json',
			            contentType: 'application/json',
					 	data: JSON.stringify(company)
					 }) */
				});

            $("#pay").click(function(){
                let ngay = new Date().getDate()+"/"+(new Date().getUTCMonth()+1)+"/"+ new Date().getFullYear()
               
				let tenKH = $("#tenCT").val()				
				let email = $("#email").val()				
				let phone = $("#phone").val()
				let diaChi =  $("#diaChi").val()												
				let tenNguoiBan = $("#employees").children("option:selected").val()
                let cuaHang = $("#stores").children("option:selected").val()                                                           
                
                let trangThai = $("#payments").children("option:selected").val()
                if (trangThai == 'Thanh toán trực tiếp'){
                	trangThai = 'Đã thanh toán'
                }else {
                	trangThai = 'Chưa thanh toán'
                }
                let tongTien = parseInt(document.getElementById("total").textContent);
                
                let order = {};
                order.ngay=ngay;
                order.tenKH = tenKH;
                order.email=email;
                order.phone=phone;
                order.diaChi=diaChi;
                order.tenNguoiBan=tenNguoiBan;
                order.cuaHang=cuaHang;
                order.trangThai=trangThai;
                order.orderItems=orderItems
                order.tongTien = tongTien;
                

                $.ajax({
                    url:"http://localhost:8080/api/them-don-hang",
                    data:JSON.stringify(order),
                    method:"post",
                    contentType: 'application/json',
                    success:function(data){
                        alert('Thanh toán thành công!!!')
                        $("#table").empty();
                        document.getElementById("sum").innerText=""
    	                document.getElementById("s").innerText=""
    	                document.getElementById("total").innerText=""
    	                
                    }
                })
                
            })
		});
		
		
		
		
	</script>
	
    
    
</body>

</html>

